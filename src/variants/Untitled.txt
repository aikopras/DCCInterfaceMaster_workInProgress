Arduino MEGA
volatile uint8_t *d1reg;	     //PORT Register

uint8_t d1bit = digitalPinToBitMask(dccRailPin);
d1reg = portOutputRegister(digitalPinToPort(dccRailPin));

*d1reg |=  d1bit; *d1reg &= ~d1bit;


================================================================================
AP_DCC_LIB - DxCore: Event system voor input
Event& myEvent = Event::assign_generator_pin(dccPin);
myEvent.set_user(user::tcb0_capt);

Maar het Event system kan ik niet gebruiken voor output naar een pins
Ik moet in de ISR iets doen zoals: ISR(TCB0_INT_vect)
{
    PORTA.OUTTGL = PIN5_bm;  // supersnel
    TCB0.INTFLAGS = TCB_CAPT_bm;
}

================================================================================
// The DCC input signal should be connected to the dccPin
// The interrupt routine that reads the value of that pin must be fast.
// The traditional Arduino digitalRead() function is relatively slow, certainly when compared to direct
// port reading, which can be done (for example) as follows: DccBitVal = !(PIND & (1<<PD3);
// However, direct port reading has as disadvantage that the port and mask should be hardcoded,
// and can not be set by the main sketch, thus the user of this library.
// Therefore we take a slightly slower approach, and use a pointer called "portInputRegister",
// which points to the right input port, and "bit", which masks the selected input port.
// To use "portInputRegister" and "bit", we basically split the Arduino digitalRead() function into:
// 1) an initialisation part, which maps dccPin to "portInputRegister" and "bit". This part may be slow
// 2) The actual reading from the port, which is fast.
//
// Comparison between approaches:               Flash  RAM  Time  Delta
//   value = (PINC & bit);                        6     1   1,09    -
//   value = (*portRegister & bit);              14     1   1,54   0,45
//   value = (*portInputRegister(port) & bit);   28     2   2,37 . 1,28
//   value = digitalRead(pin);                   88     0   3,84   2,75
//           Note: Flash & RAM in bytes / Time & Delta in microseconds
//
// Advantages of direct port access:
// - Nearly as fast as direct port reading
// - As opposed to `(PINC & bit)` constructs, works without modification also for MegaX processors.
// Disadvantages of direct port access:
// - The functions digitalPinToPort(), digitalPinToBitMask() and portInputRegister()
//   are internal and non-documented Arduino functions, and may therefore be replaced.

struct {
  uint8_t port;                               // PA=1, PB=2, PC=3, PD=4 etc.
  uint8_t bit;                                // Bitmask for reading the input Port
  volatile uint8_t *portRegister;             // PINA=$39, PINB=$36, PINC=$34, PIND=$30
} dccOut;                                      // Direct port access, to read the DCC signal fast

void initPin(uint8_t dccPin) {
  pinMode(dccPin, OUTPUT);
  // Map from dccPin to a pointer towards the port, as well as a bitmask
  dccOut.port = digitalPinToPort(dccPin);
  dccOut.bit = digitalPinToBitMask(dccPin);
  dccOut.portRegister = portInputRegister(dccOut.port);
}

Void setPin(uint8_t value) {
if (value == 0) = dccOut.portRegister & dccOut.bit = 0;
  else dccOut.portRegister & dccOut.bit = 1;
}
