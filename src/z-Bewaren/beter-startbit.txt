if (dccPacketEngine.isWaiting) {
  if (dccPacketEngine.serviceMode > 0) {...}
  else {...}
}
else {
  if ((dccPacketEngine.serviceMode == 0xFF) || (dccPacketEngine.serviceMode == 0)) {...}
  else {...}}
}


if (dccPacketEngine.serviceMode == 0 || dccPacketEngine.serviceMode == 0xFF) {

  if (dccPacketEngine.isWaiting) {
    if (dccPacketEngine.serviceMode > 0) {
      dccISR.currentPacket[0] = 0;
      dccISR.currentPacket[1] = 0;
      dccISR.currentPacket[2] = 0;
      dccISR.currentPacketSize = 3;
    }
    else {
      dccISR.currentPacket[0] = 0xFF;
      dccISR.currentPacket[1] = 0;
      dccISR.currentPacket[2] = 0xFF;
      dccISR.currentPacketSize = 3;
    }
  }
  else {
    dccISR.currentPacket[0] = dccPacketEngine.data[0];
    dccISR.currentPacket[1] = dccPacketEngine.data[1];
    dccISR.currentPacket[2] = dccPacketEngine.data[2];
    dccISR.currentPacket[3] = dccPacketEngine.data[3];
    dccISR.currentPacket[4] = dccPacketEngine.data[4];
    dccISR.currentPacket[5] = dccPacketEngine.data[5];
    dccISR.currentPacketSize = dccPacketEngine.dataSize;

    if ((dccISR.currentPacket[0] >> 4) == 0b0111)
      dccPacketEngine.serviceMode =
        0xFF - dccPacketEngine.serviceModeRepeat;
  }

  if (dccPacketEngine.serviceMode == 0 ||
      dccPacketEngine.serviceMode == 0xFF)
    dccPacketEngine.isWaiting = true;
}
else {
  dccPacketEngine.serviceMode++;
}
